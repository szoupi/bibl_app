{% load static i18n %}
<!DOCTYPE html>
<html lang="el">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
        {% block title %} Bible {% endblock title %}
    </title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
    {# load the path to static files and then the files to be loaded #}
    {# custom style always after the cdn/css framework, so as not be overiden #}
    {% load staticfiles %} 
    <link rel="manifest" href="{% static '/manifest.json' %}">

    <!-- icon in the highest resolution we need it for -->
    <link rel="icon" sizes="192x192" href="{% static 'img/bibl-192x192.png' %}">

    <!-- reuse same icon for Safari -->
    <link rel="apple-touch-icon" href="{% static 'img/bibl-250x250@2x.png' %}">
    <link rel="apple-touch-startup-image" href="{% static 'img/bibl-250x250@2x.png' %}">


    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#4285f4">

    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="96x96" href="{% static 'img/favicon-96x96.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon-16x16.png' %}">

    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}" />
    <!--
        <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png"> 
    -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-130643889-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-130643889-1');
</script>



</head>

<body>
    <!-- SIDEBAR RIGHT -->
    <div id="right-sidebar" class="ui wide right sidebar vertical menu" style="padding:1.5rem;padding-top:4rem">
        <a class="item toggle-right-sidebar">
            <i class="close icon link icon"></i>
            Απόκρυψη
        </a>
        {% block rightSidebar %}
        <div>
            Για την ώρα η στήλη αυτή έχει περιεχόμενο όταν είστε στην προβoλή των στίχων
        </div>
        {% endblock rightSidebar %}
    </div>

    <!-- SIDEBAR LEFT -->
    <div id="left-sidebar" class="ui wide sidebar vertical menu" style="padding:1.5rem;padding-top:4rem">
        {# QUICK ACCESS ////////////////////////////////////////// #}
        <a class="item toggle-left-sidebar">
            <i class="close icon link icon"></i>
            Απόκρυψη
        </a>
            
        <nav>

            <a class="item" href="{% url 'bible:index' %}">
                <i class="book icon"></i>
                Βιβλία
            </a>
            <a class="item" href="{% url 'bible:email-send' %}">
                <i class="envelope icon"></i>
                Επικοινωνία
            </a>
            {% if user.is_authenticated %}
                <a class="item" href="{% url 'bible:favorites' %}">
                    <i class="star icon"></i>
                    Αγαπημένα
                </a>
            {% endif %}
            
            {% if user.is_authenticated %} 
                {% if perms.bible.add_book %}
                <a class="item" href="{% url 'bible:book-add' %}">
                    <i class="plus icon"></i>
                    Προσθήκη Βιβλίου
                </a>
                {% endif %}
            {% endif %}


            {% if user.is_authenticated %}
                <a href="{% url 'bible:logout'%}?next={{request.path}}" class="item">Αποσύνδεση, {{ user.get_username }}</a>
            {% else %}
                <a href="{% url 'bible:login' %}?next={{request.path}}" class="item">Σύνδεση</a>
            {% endif %} 
            {# <a href="{% url 'bible:register' %}" class="item">Register</a> #}
            <a href="{% url 'bible:password_reset' %}" class="item">I forgot my password</a>
        </nav>            

        {% block quickAccess %}
        <h2>Γρήγορη Πρόσβαση</h2>
        <form name="quickAccessForm" class="ui form" style="margin-bottom: 2rem;">
            <div class="field">
                <!--<label>Book</label>-->
                <select id="select-book" class="ui search dropdown">
                    <option value="">Βιβλίο</option>
                    <!-- populate async -->
                    {% for book in data.id %}
                    <option value="{{ book.id }}">
                        {{ book.title }}</option>
                    {% endfor %}
                </select>
            </div>
        
            <div class="field">
                <!--<label>Chapter</label>-->
                <select id="select-chapter" class="ui search dropdown">
                    <option value="">Κεφάλαιο</option>
        
        
                </select>
            </div>
        
            <div class="field">
                <!--<label>verse</label>-->
                <select id="select-verse" class="ui search dropdown">
                    <option value="">Στίχος</option>
                </select>
            </div>
        
            <button id="quick-access-button" class="ui right labeled  icon button">
                <i class="right play icon"></i>
                ΜΕΤΑΒΑΣΗ
            </button>
        </form>
        <br />
        <!-- LEFT COLUMN -->



        <script>
            // TODO:
            /* add self executing function here
            faster to execute than an onload handler 
            because this waits only for the DOM to be ready, 
            not for all images to load
            */
            // POPULATE BOOKS
            document.addEventListener("DOMContentLoaded", function (event) {
                // note the trailing slash favorite/
                window.fetch("/populate/books/", {
                    method: "get",
                    credentials: "same-origin",
                    headers: {
                        "X-CSRFToken": window.csrftoken,
                        "Accept": "application/json",
                        "Content-Type": "application/json",
                    },
                })
                    .then(response => response.json())
                    .then(data => {
                        // console.log("Data fetched succesfully", data)
                        var select_book = document.getElementById('select-book')

                        // convert fetched data string  to json (objects)
                        var books = JSON.parse(data.fetchedBooks)

                        //console.log(books[0].fields.title)

                        // populate Books
                        for (i = 0; i < books.length; i++) {
                            const option = document.createElement('option');
                            // console.log(books[i].fields.title)
                            option.value = books[i].pk;
                            option.innerHTML = books[i].fields.title;
                            select_book.appendChild(option);
                        }


                    }).catch(error => console.log("books populated returned error", error));
            })


            //POPULATE CHAPTERS
            document.getElementById('select-book').addEventListener("change", function (event) {

                // note the trailing slash favorite/
                window.fetch("/populate/chapters/", {
                    method: "get",
                    credentials: "same-origin",
                    headers: {
                        "X-CSRFToken": window.csrftoken,
                        "Accept": "application/json",
                        "Content-Type": "application/json",
                    },
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log("Data fetched succesfully", data)

                        var selected_book = document.getElementById('select-book').value
                        var select_chapter = document.getElementById('select-chapter')
                        //var select_verse = document.getElementById('select-verse')
                        // console.log("selected book: ", selected_book)

                        // convert fetched data string  to json (objects)
                        var chapters = JSON.parse(data.fetchedChapters)
                        //console.log("chapters: ", chapters)

                        //var verses = JSON.parse(data.fetchedVerses)

                        // populate Chapters
                        select_chapter.innerHTML = ""; //empty select
                        for (i = 0; i < chapters.length; i++) {
                            // console.log("chapter: ", chapters[i].fields.book, chapters[i].fields.title)
                            if (chapters[i].fields.book == selected_book) {
                                const option = document.createElement('option');
                                option.value = chapters[i].pk;
                                //number - title
                                option.innerHTML = chapters[i].fields.number // + ' - ' + chapters[i].fields.title;
                                select_chapter.appendChild(option);
                            }
                        }

                        // GO TO BOOK
                        // modify form action
                        document.quickAccessForm.action = "/book/" + selected_book;
                        select_chapter.value = ""


                    }).catch(error => console.log("Chapters population returned error", error));
            })

            //POPULATE VERSES
            document.getElementById('select-chapter').addEventListener("change", function (event) {

                // note the trailing slash favorite/
                window.fetch("/populate/verses/", {
                    method: "get",
                    credentials: "same-origin",
                    headers: {
                        "X-CSRFToken": window.csrftoken,
                        "Accept": "application/json",
                        "Content-Type": "application/json",
                    },
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log("Data fetched succesfully", data)

                        var selected_book = document.getElementById('select-book').value
                        var selected_chapter = document.getElementById('select-chapter').value
                        var select_verse = document.getElementById('select-verse')
                        console.log("selected_chapter: ", selected_chapter)

                        // convert fetched data string  to json (objects)
                        var verses = JSON.parse(data.fetchedVerses)
                        console.log("verses: ", verses)


                        // populate Verses
                        select_verse.innerHTML = ""; //empty select
                        for (i = 0; i < verses.length; i++) {
                            if (verses[i].fields.chapter == selected_chapter) {
                                const option = document.createElement('option');
                                option.value = verses[i].pk;
                                //number - title
                                option.innerHTML = verses[i].fields.number // + ' - ' + verses[i].fields.original_text;
                                select_verse.appendChild(option);
                            }
                        }

                        // GO TO CHAPTER
                        // modify form action
                        document.quickAccessForm.action = "/book/" + selected_book + "/chapter/" + selected_chapter;
                        select_verse.value = ""

                    }).catch(error => console.log("Verses population returned error", error));
            });

            // GO TO VERSE
            // select-verse has been already populated onChange event of chapter-select
            document.getElementById('select-verse').addEventListener("change", function (event) {
                var selected_book = document.getElementById('select-book').value
                var selected_chapter = document.getElementById('select-chapter').value
                var selected_verse = document.getElementById('select-verse').value

                document.quickAccessForm.action = "/book/" + selected_book
                    + "/chapter/" + selected_chapter
                    + "/verse/" + selected_verse;
            });
        </script>
        
        {% endblock quickAccess %}

        {% block leftBarBreadcrumb %}
        {% endblock leftBarBreadcrumb %}
    </div>
    
    
    
<!-- PUSHER MAIN CONTENT /////////////////////////////////////////////////////////////////////////////// -->
    <div class="pusher">
        <!-- Site content !-->
        {# NAVIGATION MENU #}
        <nav class="ui menu fixed container inverted " >
            <div class="item">
                <a href="/"><img src="{% static 'img/bibl_logo.png' %}" 
                    style="height:1.3em;width:unset"
                    alt="bibl app logo"></a>
            </div>
            <a class="item toggle-left-sidebar">
                <i class="bars inverted icon"></i>
            </a>
            <a class="item tablet or lower hidden" href="{% url 'bible:index' %}">
                <i class="book inverted icon"></i>
                Βιβλία
            </a>
            <a class="item tablet or lower hidden" href="{% url 'bible:email-send' %}">
                <i class="envelope inverted icon"></i>
                Επικοινωνία
            </a>
            {% if user.is_authenticated %}
            <a class="item tablet or lower hidden" href="{% url 'bible:favorites' %}">
                <i class="star inverted icon"></i>
                Αγαπημένα
            </a>
            {% endif %}
            
            <div class="right menu">
                {% if user.is_authenticated %} 
                    {% if perms.bible.add_book %}
                    <a class="item tablet or lower hidden" href="{% url 'bible:book-add' %}">
                        <i class="plus inverted icon"></i>
                        Προσθήκη Βιβλίου
                    </a>
                    {% endif %}
                {% endif %}

                <div class="ui dropdown simple item tablet or lower hidden">
                    Σύνδεση
                    <i class="dropdown icon"></i>
                    <div class="menu">
                        {% if user.is_authenticated %}
                            <a href="{% url 'bible:logout'%}?next={{request.path}}" class="item">Αποσύνδεση, {{ user.get_username }}</a>
                        {% else %}
                            <a href="{% url 'bible:login' %}?next={{request.path}}" class="item">Σύνδεση</a>
                        {% endif %} 
                        {# <a href="{% url 'bible:register' %}" class="item">Register</a> #}
                    </div>
                </div>
                <a class="item toggle-right-sidebar">
                    <i class="info circle large inverted icon"></i>
                </a>
            </div>
        </nav>
        {# NAVIGATION MENU END  #}


        <main class="ui grid stackable container" style="margin-top:2rem">

            <div class="four wide column">
                {% block leftColumn %}
                {% endblock leftColumn %}
            </div>
            
            <div class="ten wide column">
                {% block body %}
                {% endblock body %}
            </div>
        </main>

    </div> <!--  PUSHER END -->



    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.14/semantic.min.js"></script>
    {% load static %}
    <script src="{% static "bible.js" %}"></script>

    <!-- SIDEBAR https://semantic-ui.com/modules/sidebar.html#/settings -->
    <script>
        $('#left-sidebar').first()
            .sidebar('attach events', '.toggle-left-sidebar')
            .sidebar('setting', 'dimPage', false)
            .sidebar('setting', 'closable', false)
        ;
        $('#right-sidebar').first()
            .sidebar('attach events', '.toggle-right-sidebar')
            .sidebar('setting', 'dimPage', false)
            .sidebar('setting', 'closable', false)
        ;

    </script>
    
    {# DEBUG #}
    {# <pre> {% filter force_escape %} {% debug %} {% endfilter %} </pre> #}
</body>

</html>